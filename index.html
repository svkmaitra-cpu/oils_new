<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfume Oil Stock Manager Search</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        /* General Body and Font Styles */
        body {
            background-color: #f9fafb; /* bg-gray-50 */
            font-family: 'Inter', sans-serif;
            padding: 1rem; /* p-4 */
            color: #374151; /* text-gray-800 */
        }

        /* Main Container Styling */
        .container {
            max-width: 960px; /* max-w-4xl */
            margin-left: auto; /* mx-auto */
            margin-right: auto; /* mx-auto */
            background-color: #ffffff; /* bg-white */
            padding: 1.5rem; /* p-6 */
            border-radius: 1.5rem; /* rounded-3xl */
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); /* shadow-2xl */
        }
        @media (min-width: 768px) {
            .container {
                padding: 2.5rem; /* md:p-10 */
            }
        }

        /* Header Styling */
        header {
            text-align: center; /* text-center */
            margin-bottom: 2.5rem; /* mb-10 */
        }
        .header-title {
            font-size: 2.25rem; /* text-4xl */
            font-weight: 800; /* font-extrabold */
            color: #2563eb; /* text-blue-600 */
            line-height: 1.25; /* leading-tight */
        }
        @media (min-width: 768px) {
            .header-title {
                font-size: 3rem; /* md:text-5xl */
            }
        }
        .header-subtitle {
            margin-top: 0.5rem; /* mt-2 */
            font-size: 1.125rem; /* text-lg */
            color: #6b7280; /* text-gray-500 */
        }

        /* Section Styling */
        .section {
            background-color: #f8fafc; /* bg-slate-50 */
            padding: 1.5rem; /* p-6 */
            border-radius: 1rem; /* rounded-2xl */
            box-shadow: inset 0 2px 4px 0 rgba(0, 0, 0, 0.06); /* shadow-inner */
            border: 1px solid #f3f4f6; /* border border-gray-100 */
        }

        /* Section Header */
        .section-header {
            font-size: 1.5rem; /* text-2xl */
            font-weight: 700; /* font-bold */
            margin-bottom: 1rem; /* mb-4 */
            color: #4b5563; /* text-gray-700 */
        }

        /* Form and Input Styles */
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 1rem; /* space-y-4 */
        }
        .input-field {
            width: 100%; /* w-full */
            padding: 0.75rem; /* p-3 */
            border-radius: 0.75rem; /* rounded-xl */
            border: 1px solid #d1d5db; /* border border-gray-300 */
            outline: none; /* focus:outline-none */
            transition: box-shadow 0.2s, border-color 0.2s;
        }
        .input-field:focus {
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.5); /* focus:ring-2 focus:ring-blue-500 */
            border-color: #3b82f6;
        }
        .btn {
            width: 100%; /* w-full */
            padding: 0.75rem; /* py-3 */
            font-weight: 700; /* font-bold */
            color: #ffffff;
            border-radius: 0.75rem; /* rounded-xl */
            transition-property: background-color, border-color, color, box-shadow;
            transition-duration: 0.3s;
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
        }
        .btn-blue {
            background-color: #3b82f6; /* bg-blue-500 */
        }
        .btn-blue:hover {
            background-color: #2563eb; /* hover:bg-blue-600 */
        }
        
        /* Message and Loading Styles */
        #loading-indicator {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 1rem 0; /* py-4 */
        }
        #loading-indicator > div {
            width: 2rem; /* w-8 */
            height: 2rem; /* h-8 */
            border-radius: 9999px; /* rounded-full */
            border-bottom-width: 2px; /* border-b-2 */
            border-color: #3b82f6; /* border-blue-500 */
            animation: spin 1s linear infinite;
        }
        #loading-indicator p {
            margin-left: 0.5rem; /* ml-2 */
            color: #3b82f6; /* text-blue-500 */
        }
        .status-message {
            padding: 0.5rem; /* p-2 */
            margin-top: 1rem; /* mt-4 */
            text-align: center;
            border-radius: 0.5rem; /* rounded-lg */
        }
        .status-message.error {
            background-color: #ef4444; /* bg-red-500 */
            color: #ffffff; /* text-white */
        }
        .status-message.success {
            background-color: #22c55e; /* bg-green-500 */
            color: #ffffff; /* text-white */
        }

        /* Search Result Styling */
        .search-result {
            background-color: #dcfce7; /* bg-green-100 */
            padding: 1rem; /* p-4 */
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); /* shadow-sm */
            margin-bottom: 0.5rem; /* mb-2 */
        }
        .search-result p {
            font-size: 0.875rem; /* text-sm */
            color: #4b5563; /* text-gray-600 */
        }

        /* Miscellaneous */
        .hidden {
            display: none;
        }
        .flex {
            display: flex;
        }
        .justify-center {
            justify-content: center;
        }
        .items-center {
            align-items: center;
        }
        .space-y-4 > * + * {
            margin-top: 1rem; /* space-y-4 */
        }
        .space-y-3 > * + * {
            margin-top: 0.75rem; /* space-y-3 */
        }
        .flex-grow {
            flex-grow: 1;
        }
        .mt-6 {
            margin-top: 1.5rem;
        }
        .mb-2 {
            margin-bottom: 0.5rem;
        }
        .mb-4 {
            margin-bottom: 1rem;
        }

        /* Animations */
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="container">
        <header>
            <h1 class="header-title">Perfume Oil Stock Search</h1>
            <p class="header-subtitle">Find your oils by name, brand, type, or box.</p>
        </header>

        <!-- Loading Indicator -->
        <div id="loading-indicator" class="hidden">
            <div></div>
            <p>Loading...</p>
        </div>

        <div id="status-message" class="hidden"></div>
        
        <!-- Search Section -->
        <section class="section">
            <h2 class="section-header">Search for an Oil</h2>
            <form id="search-form" class="form-group">
                <div>
                    <input type="text" id="search-query" placeholder="e.g., Lavender, F1, Essential" class="input-field">
                </div>
                <button type="submit" class="btn btn-blue">
                    Search
                </button>
            </form>
            <div id="search-results" class="space-y-3 mt-6"></div>
        </section>
    </div>
</body>

<script>
    // Constants for Google Sheets API communication
    const GOOGLE_SHEET_ID = '1eHsDK2jdK1LWEm0BOEaS5I3agBZQe38Qvex8yLB0-50';
    const API_URL_PREFIX = 'https://docs.google.com/spreadsheets/d/';

    // UI elements
    const statusMessageEl = document.getElementById('status-message');
    const searchForm = document.getElementById('search-form');
    const searchResultsEl = document.getElementById('search-results');
    const loadingIndicator = document.getElementById('loading-indicator');

    let boxesData = {}; // Cache for all fetched boxes data

    /**
     * Shows a status message to the user.
     * @param {string} message The message to display.
     * @param {boolean} [isError=false] True if the message is an error, false otherwise.
     */
    function showStatus(message, isError = false) {
        statusMessageEl.textContent = message;
        statusMessageEl.className = `status-message ${isError ? 'error' : 'success'}`;
        setTimeout(() => {
            statusMessageEl.textContent = '';
            statusMessageEl.className = 'hidden';
        }, 5000);
    }

    /**
     * Toggles the visibility of the loading indicator.
     * @param {boolean} show True to show, false to hide.
     */
    function showLoading(show) {
        loadingIndicator.classList.toggle('hidden', !show);
    }

    /**
     * Fetches all data from the Google Sheet.
     */
    async function fetchAllData() {
        showLoading(true);
        boxesData = {};

        try {
            // Generate sheet names based on a known pattern
            const sheetNames = [];
            for (let i = 1; i <= 10; i++) {
                sheetNames.push(`F${i}`);
            }
            for (let i = 1; i <= 4; i++) {
                sheetNames.push(`E${i}`);
            }
            sheetNames.push('FC', 'Flavor');

            const fetchPromises = sheetNames.map((sheetName) =>
                fetch(`${API_URL_PREFIX}${GOOGLE_SHEET_ID}/gviz/tq?sheet=${sheetName}&tqx=out:csv`)
                    .then(res => res.text())
                    .then(csvText => {
                        const lines = csvText.split('\n').slice(1);
                        const oils = lines.map(line => {
                            const [brand, name, type] = line.split(',').map(s => s.trim().replace(/^"|"$/g, ''));
                            return { brand, name, type };
                        }).filter(oil => oil.name);
                        boxesData[sheetName] = { name: sheetName, oils };
                    })
                    .catch(e => console.error(`Error fetching sheet ${sheetName}:`, e))
            );

            await Promise.all(fetchPromises);
            
            showLoading(false);
            showStatus('Data loaded successfully from Google Sheets!');

        } catch (error) {
            console.error("Error fetching data:", error);
            showLoading(false);
            showStatus("Failed to load data from Google Sheets.", true);
        }
    }

    /**
     * Searches for an oil across all boxes by name, brand, type, or box name.
     * @param {Event} event The form submission event.
     */
    async function searchOil(event) {
        event.preventDefault();
        searchResultsEl.innerHTML = '';
        const query = document.getElementById('search-query').value.trim().toLowerCase();
        if (!query) {
            showStatus('Please enter a search query.', true);
            return;
        }

        showLoading(true);
        let found = false;
        
        for (const boxName in boxesData) {
            const box = boxesData[boxName];
            const matchedOils = box.oils.filter(oil => 
                oil.name.toLowerCase().includes(query) ||
                oil.brand.toLowerCase().includes(query) ||
                oil.type.toLowerCase().includes(query) ||
                boxName.toLowerCase().includes(query)
            );
            if (matchedOils.length > 0) {
                found = true;
                matchedOils.forEach(oil => {
                    const resultCard = document.createElement('div');
                    resultCard.className = 'search-result';
                    resultCard.innerHTML = `
                        <p class="font-bold text-gray-800">${oil.name}</p>
                        <p>Found in: <span class="font-semibold">${box.name}</span></p>
                        <p>Brand: ${oil.brand}</p>
                        <p>Type: ${oil.type}</p>
                    `;
                    searchResultsEl.appendChild(resultCard);
                });
            }
        }

        if (!found) {
            searchResultsEl.innerHTML = `<p class="text-center text-gray-500">No oils found matching "${query}".</p>`;
        }
        showLoading(false);
    }
    
    // Event listeners for user interactions
    searchForm.addEventListener('submit', searchOil);
    
    // Initial data fetch on page load
    window.onload = fetchAllData;
</script>
</html>
